server {
        listen  174.34.170.138:80; ## listen for ipv4; this line is default and implied
        #listen   [::]:80 default_server ipv6only=on; ## listen for ipv6
server_name my.cloudrck.com;
rewrite ^(.*) https://$server_name$1 permanent; 
}

server {
        listen  174.34.170.138:443;
ssl on;
	ssl_certificate /etc/nginx/certs/my_cloudrck_com.pem;
	ssl_certificate_key /etc/nginx/certs/my.cloudrck.com.key;
keepalive_timeout 75 75;
        root /home/dljacobs/blesta3/public_html;
        index index.php index.html index.htm;
error_log  /home/dljacobs/logs/nginx_error.log  warn;
        # Make site accessible from http://localhost/
        server_name my.cloudrck.com;


        # Only for nginx-naxsi used with nginx-naxsi-ui : process denied requests
        #location /RequestDenied {
        #       proxy_pass http://127.0.0.1:8080;
        #}

        #error_page 404 /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
                root /usr/share/nginx/www;
        }

        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
location ~ \.php$ {
                try_files $uri =404;
                fastcgi_split_path_info ^(.+\.php)(/.+)$;
                # NOTE: You should have "cgi.fix_pathinfo = 0;" in php.ini
fastcgi_connect_timeout 60;
fastcgi_send_timeout 180;
fastcgi_read_timeout 180;
fastcgi_buffer_size 128k;
fastcgi_buffers 4 256k;
fastcgi_busy_buffers_size 256k;
fastcgi_temp_file_write_size 256k;
fastcgi_intercept_errors on;
                # With php5-cgi alone:
                #fastcgi_pass 127.0.0.1:9000;
                # With php5-fpm:
                fastcgi_pass unix:/var/run/php5-fpm.sock;
               fastcgi_index index.php;
                include fastcgi_params;
        }
location ~ (\.pdt) {
    return 403;
}
#location ^~ /.pdt {
 #   return 404;
#}
#location / {
 # if (!-e $request_filename){
  #  rewrite ^(.*)$ /index.php;
  #}
  #if ($request_uri ~ "^(.*)/install.php$"){
   # rewrite install.php /%1/install/ redirect;
  #}
#}
location / {
  error_page     404 = @blesta;
  log_not_found  off;
if ($request_uri ~ "^(.*)/install.php$"){
    rewrite install.php /%1/install/ redirect;
  }
}
 
location @blesta {
  rewrite ^(.*)$ /index.php last; 
}







#location / {
##rewrite ^/downloads/?$ /?cmd=downloads last;
#if (!-f $request_filename){
#	set $rule_1 1$rule_1;
#}
#if (!-d $request_filename){
#	set $rule_1 2$rule_1;
#}
#if ($rule_1 = "21"){
#	rewrite ^/(.*)$ /index.php?/$1 last;
#}            
#try_files   $uri $uri/ /index.php;
 #       }

}
